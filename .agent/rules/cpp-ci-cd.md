---
trigger: model_decision
description: Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ CI/CD (Git Hooks, Ð²ÐµÑ‚Ð²Ð»ÐµÐ½Ð¸Ðµ, Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ, Ñ‚ÐµÑÑ‚Ñ‹)
---

Ð¢Ñ‹ â€” DevOps Engineer Ð¸ ÑÐºÑÐ¿ÐµÑ€Ñ‚ Ð¿Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð½Ð° C++23.
Ð¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° â€” ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ shell-ÑÐºÑ€Ð¸Ð¿Ñ‚ (`setup_hooks.sh`) Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸.

### 1. Ð—Ð°Ð´Ð°Ñ‡Ð¸ Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ð°
Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ:

1.  **Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Git Ð¸ Ð’ÐµÑ‚Ð¾Ðº:**
    *   Ð£Ð±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½ (`git init`).
    *   Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ `.gitignore` Ð´Ð»Ñ `build/`, `.cache/`, `.vscode/`, `.clangd/` Ð¸ Ð±Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð², ÐµÑÐ»Ð¸ Ð¾Ð½ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚.
    *   ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²ÐµÑ‚Ð¾Ðº `main` Ð¸ `dev` Ð´Ð°Ð¶Ðµ Ð² Ð¿ÑƒÑÑ‚Ð¾Ð¼ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸.
    *   ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð½Ð° Ð²ÐµÑ‚ÐºÑƒ `dev`.

2.  **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° `pre-commit` Ð¥ÑƒÐºÐ° (Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ):**
    *   Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» `.git/hooks/pre-commit`.
    *   **Ð›Ð¾Ð³Ð¸ÐºÐ°:** Ð¥ÑƒÐº Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ `clang-format -i` Ð´Ð»Ñ Ð²ÑÐµÑ… **Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ…** (staged) Ñ„Ð°Ð¹Ð»Ð¾Ð² `.hpp`, `.cpp`, `.h`, `.c` (ÐºÑ€Ð¾Ð¼Ðµ `build/` Ð¸ `external/`).
    *   **Ð’Ð°Ð¶Ð½Ð¾:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ `git diff --cached --name-only`.
    *   Ð•ÑÐ»Ð¸ `clang-format` Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð» Ñ„Ð°Ð¹Ð»Ñ‹, Ñ…ÑƒÐº Ð´Ð¾Ð»Ð¶ÐµÐ½ **Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚** (exit 1) Ð¸ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ, ÐºÐ°ÐºÐ¸Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð±Ñ‹Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð½ Ð¼Ð¾Ð³ Ð¸Ñ… Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð¸Ð½Ð´ÐµÐºÑ.

3.  **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° `pre-push` Ð¥ÑƒÐºÐ° (Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ):**
    *   Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» `.git/hooks/pre-push`.
    *   **Ð›Ð¾Ð³Ð¸ÐºÐ°:**
        1.  Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ±Ð¾Ñ€ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ñ‡ÐµÑ€ÐµÐ· CMake. **Ð’Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Windows:** Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„Ð»Ð°Ð³ `--config Debug` Ð´Ð»Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸-ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ñ… Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð² (Visual Studio).
        2.  Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹ Ñ‡ÐµÑ€ÐµÐ· CTest. **Ð’Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Windows:** Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ„Ð»Ð°Ð³ `-C Debug`.
    *   Ð•ÑÐ»Ð¸ ÑÐ±Ð¾Ñ€ÐºÐ° Ð¸Ð»Ð¸ Ñ‚ÐµÑÑ‚Ñ‹ Ð¿Ð°Ð´Ð°ÑŽÑ‚, `git push` Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½ (exit 1).

4.  **ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°:**
    *   Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ ÑÐ°Ð¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ…ÑƒÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¼Ð¸ (`chmod +x`).

### 2. Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ðº ÐšÐ¾Ð´Ñƒ
*   Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ **Bash**. (ÐÐ° Windows ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ· Git Bash: `bash setup_hooks.sh`).
*   ÐšÐ¾Ð´ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¸Ð´ÐµÐ¼Ð¿Ð¾Ñ‚ÐµÐ½Ñ‚Ð½Ñ‹Ð¼ (Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð¼Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ).
*   Ð”Ð¾Ð±Ð°Ð²ÑŒ Ñ†Ð²ÐµÑ‚Ð½Ð¾Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ (`echo -e "\033[...m"`) Ð´Ð»Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¾ ÑˆÐ°Ð³Ð°Ñ….
*   **Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ Windows:** Ð£Ð±ÐµÐ´Ð¸ÑÑŒ, Ñ‡Ñ‚Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ CMake Ð¸ CTest Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ñ„Ð»Ð°Ð³Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ (`--config`, `-C`), Ñ‚Ð°Ðº ÐºÐ°Ðº Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Visual Studio Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ `CMAKE_BUILD_TYPE` Ð¿Ñ€Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸.

### 3. ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ð¾Ð³Ð¾ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°
Ð’Ñ‹Ð²ÐµÐ´Ð¸ **Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ ÐºÐ¾Ð´** ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° `setup_hooks.sh`.

```bash
#!/bin/bash
set -e

# ... (Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸ .gitignore)

# ... (Branch setup - handle fresh repo case correctly)

# ... (pre-commit hook: clang-format check)

cat > .git/hooks/pre-push << 'EOF'
#!/bin/bash
echo "ðŸ§ª Running Tests before Push..."

# ... (Build dir setup)

# Windows-compatible build and test
if ! cmake --build . --config Debug; then
   echo "âŒ Build failed."
   exit 1
fi

# -C Debug is crucial for Visual Studio generator
if ! ctest -C Debug --output-on-failure; then
    echo "âŒ Tests failed."
    exit 1
fi
EOF

chmod +x .git/hooks/pre-commit .git/hooks/pre-push
echo "âœ… Setup Complete!"